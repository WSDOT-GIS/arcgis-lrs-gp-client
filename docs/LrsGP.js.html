<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: LrsGP.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: LrsGP.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>ï»¿(function (root, factory) {
    if (typeof define === 'function' &amp;&amp; define.amd) {
        // AMD. Register as an anonymous module.
        define(["./arcGisRestApiUtils", "./LrsGPParameters"], factory);
    } else if (typeof module === 'object' &amp;&amp; module.exports) {
        module.exports = factory(require('./arcGisRestApiUtils.js'), require('./LrsGPParameters.js'), require('node-fetch'));
    } else {
        // Browser globals
        root.LrsGP = factory(root.arcGisRestApiUtils, root.LrsGPParameters, root.fetch);
    }
}(this, function (arcGisRestApiUtils, LrsGPParameters, fetchFunction) {
    if (fetchFunction) {
        fetch = fetchFunction;
    }

    /**
     * A module for calling the LRS geoprocessing service.
     * @module LrsGP
     */

    /**
     * @external GPResult
     * @see {@link http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/GP_Result/02r3000000q7000000/|GP Result}
     */

    /**
     * @external FeatureSet
     * @see {@link http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/FeatureSet_object/02r3000002mn000000/|FeatureSet object}
     */

    /**
     * Executes a synchronous GP tool.
     * @param {string} url - The URL to execute the GP tool.
     * @returns {Promise.&lt;external:FeatureSet>} A promise with the results of the GP tool.
     */
    function execute(url) {
        return new Promise(function (resolve, reject) {
            fetch(url).then(function (response) {
                if (response.ok) {
                    response.json().then(function (j) {
                        if (j.error) {
                            reject(j.error);
                        } else {
                            resolve(j.results[0].value);
                        }
                    });
                } else {
                    reject({
                        status: response.status,
                        statusText: response.statusText
                    });
                }
            });
        });
    }

    /**
     * @constructor
     * @alias module:LrsGP
     * @param {Object} options - Constructor options.
     * @param {string} options.url - The URL of the linear referencing GP service.
     * @param {Boolean} [options.async=false] - Specifies that the GP service is asynchronous.
     * @param {string} [options.pointTaskName="Points to Route Events"] - Name of the task that converts points to route events.
     * @param {string} [options.linesTaskName="Points to Route Segments"] - Name of the task that converts polylines to route events.
     * @example
     * var lrs = new LrsGP({url: "http://example.com/arcgis/rest/services/OptionalFolderLevel/LinearReferencing/GPServer" });
     * @throws {TypeError} Thrown if either no options are provided or no "url" is provided within the options.
     */
    function LrsGP(options) {
        if (!options) {
            throw new TypeError("No options were provided.");
        } else if (!options.url) {
            throw new TypeError("No url option was provided.");
        }
        // Set the url variable and trim trailing
        var url = options.url.replace(/\/$/, "");
        var pointTaskName = options.pointTaskName || "Points to Route Events";
        var linesTaskName = options.linesTaskName || "Points to Route Segments";
        var async = options.async || false;

        // TODO: Implement Async support.
        if (async) {
            throw new Error("Async support has not been implemented yet.");
        }

        Object.defineProperties(this, {
            /**
             * @member {string} - The geoprocessing service URL.
             */
            url: {
                value: url
            },
            /**
             * @member {string} - URL for the point location task.
             */
            pointTaskUrl: {
                get: function () {
                    return [url, pointTaskName, async ? "submitJob" : "execute"].join("/");
                }
            },
            /**
             * @member {string} - URL for the line segment location task.
             */
            linesTaskUrl: {
                get: function () {
                    return [url, linesTaskName, async ? "submitJob" : "execute"].join("/");
                }
            }
        });
    }

    /**
     * Locates points along routes.
     * @param {module:LrsGPParameters} lrsGpParams - LRS GP Parameters.
     * @returns {Promise.&lt;external:FeatureSet>} - Returns a promise with a Feature Set.
     * @example
     * var inFeatures = {
     *  "geometryType": "esriGeometryPoint",
     *  "spatialReference": {
     *      "wkid": 2927
     *  },
     *  "features": [
     *    {
     *        "geometry": {
     *            "x": 1108486.9299805611,
     *            "y": 647781.35678572953
     *        }
     *    },
     *    {
     *        "geometry": {
     *            "x": 1109214.2005076408,
     *            "y": 648022.67913772166
     *        }
     *    }
     *   ]
     *  };
     *
     *  var lrsParams = new LrsGPParameters({
     *      Input_Features = inFeatures,
     *      Search_Radius = new LinearUnit(50, LinearUnit.UNIT_VALUES.FEET)
     *  });
     *  var gp = new LrsGP(new LrsGP({
     *      url: "http://example.com/arcgis/rest/services/OptionalFolderLevel/LinearReferencing/GPServer"
     *  });
     *  gp.pointsToRouteEvents(lrsParams).then(function(featureSet) {
     *      // Do something with the feature set.
     *      console.debug(featureSet);
     *  });
     */
    LrsGP.prototype.pointsToRouteEvents = function (lrsGpParams) {
        var url = this.pointTaskUrl;
        url += "?" + lrsGpParams.toUrlSearch();
        return execute(url);
    };

    /**
     * Locates line segments along routes.
     * @param {module:LrsGPParameters} lrsGpParams - LRS GP Parameters.
     * @returns {Promise.&lt;external:FeatureSet>} - Returns a promise with a Feature Set.
     * @example
     * var inFeatures = {
     *  "geometryType": "esriGeometryPoint",
     *  "spatialReference": {
     *      "wkid": 2927
     *  },
     *  "features": [
     *    {
     *        "geometry": {
     *            "x": 1108486.9299805611,
     *            "y": 647781.35678572953
     *        }
     *    },
     *    {
     *        "geometry": {
     *            "x": 1109214.2005076408,
     *            "y": 648022.67913772166
     *        }
     *    }
     *   ]
     *  };
     *
     *  var lrsParams = new LrsGPParameters({
     *      Input_Features = inFeatures,
     *      Search_Radius = new LinearUnit(50, LinearUnit.UNIT_VALUES.FEET)
     *  });
     *  var gp = new LrsGP(new LrsGP({
     *      url: "http://example.com/arcgis/rest/services/OptionalFolderLevel/LinearReferencing/GPServer"
     *  });
     *  gp.pointsToRouteSegements(lrsParams).then(function(featureSet) {
     *      // Do something with the feature set.
     *      console.debug(featureSet);
     *  });
     */
    LrsGP.prototype.pointsToRouteSegments = function (lrsGpParams) {
        var url = this.linesTaskUrl;
        url += "?" + lrsGpParams.toUrlSearch();
        return execute(url);
    };

    return LrsGP;

}));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-EventTableProperties.html">EventTableProperties</a></li><li><a href="module-LinearUnit.html">LinearUnit</a></li><li><a href="module-LrsGP.html">LrsGP</a></li><li><a href="module-LrsGPParameters.html">LrsGPParameters</a></li><li><a href="module-LrsGPWorker.html">LrsGPWorker</a></li></ul><h3>Externals</h3><ul><li><a href="external-FeatureSet.html">FeatureSet</a></li><li><a href="external-Geometry.html">Geometry</a></li><li><a href="external-GPResult.html">GPResult</a></li><li><a href="external-SpatialReference.html">SpatialReference</a></li></ul><h3>Classes</h3><ul><li><a href="module-EventTableProperties.html">EventTableProperties</a></li><li><a href="module-LinearUnit.html">LinearUnit</a></li><li><a href="module-LrsGP.html">LrsGP</a></li><li><a href="module-LrsGPParameters.html">LrsGPParameters</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Apr 06 2016 12:57:36 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
